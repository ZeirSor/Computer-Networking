#  Chapter 4 Network layer

<!-- TOC -->

- [1. 网络层概述](#1-网络层概述)
	- [1.1. 分组转发和路由选择](#11-分组转发和路由选择)
	- [1.2. 网络层向其上层提供的两种服务](#12-网络层向其上层提供的两种服务)
		- [1.2.1. 面向连接的虚电路服务](#121-面向连接的虚电路服务)
		- [1.2.2. 无连接的数据报服务](#122-无连接的数据报服务)
- [2. 网际协议IP](#2-网际协议ip)
	- [2.1. 异构网络互连](#21-异构网络互连)
	- [2.2. IPv4地址及其编址方法](#22-ipv4地址及其编址方法)
		- [2.2.1. 概述](#221-概述)
		- [2.2.2. 表示方法：点分十进制](#222-表示方法点分十进制)
		- [2.2.3. 分类编制方法](#223-分类编制方法)
		- [2.2.4. 划分子网的编址方法](#224-划分子网的编址方法)
		- [2.2.5. 无分类编址方法](#225-无分类编址方法)
	- [2.3. IPv4地址的应用规划](#23-ipv4地址的应用规划)
		- [2.3.1. 定长子网掩码](#231-定长子网掩码)
		- [2.3.2. 变长子网掩码](#232-变长子网掩码)
	- [2.4. IPv4地址与MAC地址](#24-ipv4地址与mac地址)
		- [2.4.1. IPv4地址与MAC地址的封装位置](#241-ipv4地址与mac地址的封装位置)
		- [2.4.2. 数据包传送过程中IPv4地址与MAC地址的变化情况](#242-数据包传送过程中ipv4地址与mac地址的变化情况)
		- [2.4.3. IPv4地址与MAC地址的关系](#243-ipv4地址与mac地址的关系)
	- [2.5. 地址解析协议ARP](#25-地址解析协议arp)
	- [2.6. IP数据报的发送和转发流程](#26-ip数据报的发送和转发流程)
		- [2.6.1. 主机发送IP数据报](#261-主机发送ip数据报)
		- [2.6.2. 路由器转发IP数据报](#262-路由器转发ip数据报)
	- [2.7. IPv4数据报的首部格式](#27-ipv4数据报的首部格式)
		- [2.7.1. 版本](#271-版本)
		- [2.7.2. 首部长度](#272-首部长度)
		- [2.7.3. 可选字段](#273-可选字段)
		- [2.7.4. 填充](#274-填充)
		- [2.7.5. 区分服务](#275-区分服务)
		- [2.7.6. 总长度](#276-总长度)
		- [2.7.7. IP数据包分片](#277-ip数据包分片)
			- [2.7.7.1. 标识](#2771-标识)
			- [2.7.7.2. 标志](#2772-标志)
			- [2.7.7.3. 片偏移](#2773-片偏移)
		- [2.7.8. 生存时间（Time To Live，TTL）](#278-生存时间time-to-livettl)
		- [2.7.9. 协议](#279-协议)
		- [2.7.10. 首部检验和](#2710-首部检验和)
			- [2.7.10.1. 首部检验和的计算方法](#27101-首部检验和的计算方法)
		- [2.7.11. 源IP地址](#2711-源ip地址)
		- [2.7.12. 目的IP地址](#2712-目的ip地址)
- [3. 静态路由配置](#3-静态路由配置)
	- [3.1. 人工配置静态路由](#31-人工配置静态路由)
	- [3.2. 默认路由0.0.0.0/0](#32-默认路由00000)
	- [3.3. 特定主机路由/32](#33-特定主机路由32)
	- [3.4. 需注意的问题](#34-需注意的问题)
- [4. 因特网的路由选择协议](#4-因特网的路由选择协议)
	- [4.1. 路由选择分类](#41-路由选择分类)
		- [4.1.1. 静态路由选择](#411-静态路由选择)
		- [4.1.2. 动态路由选择](#412-动态路由选择)
	- [4.2. 因特网采用分层次的路由选择协议](#42-因特网采用分层次的路由选择协议)
		- [4.2.1. 特点](#421-特点)
		- [4.2.2. 举例](#422-举例)
	- [4.3. 路由信息协议RIP（封装在UDP）](#43-路由信息协议rip封装在udp)
		- [4.3.1. 基本概念](#431-基本概念)
		- [4.3.2. 基本工作过程](#432-基本工作过程)
		- [4.3.3. 距离向量算法](#433-距离向量算法)
		- [4.3.4. 存在的问题——“坏消息传播得慢”](#434-存在的问题坏消息传播得慢)
		- [4.3.5. 版本和相关报文的封装](#435-版本和相关报文的封装)
		- [4.3.6. 优缺点](#436-优缺点)
	- [4.4. 开放最短路径优先OSPF（封装在IP）](#44-开放最短路径优先ospf封装在ip)
		- [4.4.1. 基本概念](#441-基本概念)
		- [4.4.2. 五种分组类型](#442-五种分组类型)
		- [4.4.3. 基本工作过程](#443-基本工作过程)
		- [4.4.4. 多点接入网络中得OSPF路由器](#444-多点接入网络中得ospf路由器)
		- [4.4.5. OSPF划分区域](#445-ospf划分区域)
	- [4.5. 边界网关协议BGP（封装在TCP）](#45-边界网关协议bgp封装在tcp)
		- [4.5.1. 基本概念](#451-基本概念)
		- [4.5.2. BGP-4的四种报文](#452-bgp-4的四种报文)
	- [4.6. 路由器的基本工作原理](#46-路由器的基本工作原理)
- [5. 网际控制协议ICMP（封装在IP）](#5-网际控制协议icmp封装在ip)
	- [5.1. 概述](#51-概述)
	- [5.2. ICMP报文种类](#52-icmp报文种类)
		- [5.2.1. 差错报告报文](#521-差错报告报文)
		- [5.2.2. 询问报文](#522-询问报文)
	- [5.3. ICMP的典型应用](#53-icmp的典型应用)
		- [5.3.1. 分组网间探测（Packet InterNet Groper，PING）](#531-分组网间探测packet-internet-groperping)
		- [5.3.2. 跟踪路由（traceroute）](#532-跟踪路由traceroute)
- [6. 虚拟专用网VPN和网络地址转换NAT](#6-虚拟专用网vpn和网络地址转换nat)
	- [6.1. 虚拟专用网VPN](#61-虚拟专用网vpn)
	- [6.2. 网络地址转换NAT](#62-网络地址转换nat)
		- [6.2.1. 最基本的NET方法](#621-最基本的net方法)
		- [6.2.2. 网络地址与端口号转换方法（NAPT）](#622-网络地址与端口号转换方法napt)
- [7. IP多播技术](#7-ip多播技术)
	- [7.1. 相关基本概念](#71-相关基本概念)
	- [7.2. IP多播地址和多播组](#72-ip多播地址和多播组)
	- [7.3. 在局域网上进行硬件多播](#73-在局域网上进行硬件多播)
	- [7.4. 在因特网上进行IP多播需要的两种协议](#74-在因特网上进行ip多播需要的两种协议)
	- [7.5. 网际组管理协议IGMP（封装在IP）](#75-网际组管理协议igmp封装在ip)
		- [7.5.1. 三种报文类型](#751-三种报文类型)
		- [7.5.2. 基本工作原理](#752-基本工作原理)
			- [7.5.2.1. 加入多播组](#7521-加入多播组)
			- [7.5.2.2. 监视多播组的成员变化](#7522-监视多播组的成员变化)
			- [7.5.2.3. 退出多播组](#7523-退出多播组)
	- [7.6. 多播路由选择协议（封装在）](#76-多播路由选择协议封装在)
		- [7.6.1. 多播路由选择协议](#761-多播路由选择协议)
			- [7.6.1.1. 基于源树多播路由选择](#7611-基于源树多播路由选择)
			- [7.6.1.2. 组共享树多播路由选择](#7612-组共享树多播路由选择)
		- [7.6.2. 因特网的多播路由选择协议](#762-因特网的多播路由选择协议)
- [8. 移动IP技术概述](#8-移动ip技术概述)
	- [8.1. 移动性对因特网应用的影响](#81-移动性对因特网应用的影响)
	- [8.2. 移动IP技术的相关基本概念](#82-移动ip技术的相关基本概念)
	- [8.3. 移动IP技术的基本工作原理](#83-移动ip技术的基本工作原理)
		- [8.3.1. 代理发现与注册](#831-代理发现与注册)
		- [8.3.2. 固定主机向移动主机发送IP数据报](#832-固定主机向移动主机发送ip数据报)
		- [8.3.3. 移动主机向固定主机发送IP数据报](#833-移动主机向固定主机发送ip数据报)
		- [8.3.4. 同址转交地址方式](#834-同址转交地址方式)
		- [8.3.5. 三角形路由问题](#835-三角形路由问题)
- [9. IPv6](#9-ipv6)
	- [9.1. IPv6的诞生背景](#91-ipv6的诞生背景)
	- [9.2. IPv6引进的主要变化](#92-ipv6引进的主要变化)
	- [9.3. IPv6数据包的基本首部](#93-ipv6数据包的基本首部)
	- [9.4. IPv6数据包的扩展首部](#94-ipv6数据包的扩展首部)
	- [9.5. IPv6地址](#95-ipv6地址)
		- [9.5.1. IPv6地址空间大小](#951-ipv6地址空间大小)
		- [9.5.2. IPv6地址的表示方法](#952-ipv6地址的表示方法)
		- [9.5.3. IPv6地址的分类](#953-ipv6地址的分类)
	- [9.6. 从IPv4向IPv6过渡](#96-从ipv4向ipv6过渡)
		- [9.6.1. 使用双协议栈](#961-使用双协议栈)
		- [9.6.2. 使用隧道技术](#962-使用隧道技术)
	- [9.7. 网际控制报文协议ICMPv6](#97-网际控制报文协议icmpv6)
		- [9.7.1. 概述](#971-概述)
		- [9.7.2. ICMPv6报文的封装](#972-icmpv6报文的封装)
		- [9.7.3. ICMPv6报文的分类](#973-icmpv6报文的分类)
- [10. 软件定义网络SDN](#10-软件定义网络sdn)
	- [10.1. 概述](#101-概述)
	- [10.2. 网络层的数据层面和控制层面](#102-网络层的数据层面和控制层面)
	- [10.3. OpenFlow协议](#103-openflow协议)
		- [10.3.1. 概述](#1031-概述)
		- [10.3.2. 传统意义上的数据层面的任务](#1032-传统意义上的数据层面的任务)
		- [10.3.3. SDN中的广义转发](#1033-sdn中的广义转发)
		- [10.3.4. OpenFLow交换机和流表](#1034-openflow交换机和流表)
	- [10.4. SDN体系结构](#104-sdn体系结构)
		- [10.4.1. SDN体系结构及其四个关键特征](#1041-sdn体系结构及其四个关键特征)
		- [10.4.2. SDN控制器](#1042-sdn控制器)
	- [10.5. 总结](#105-总结)
- [11. 题目](#11-题目)
	- [11.1. IPv4分类编址方法](#111-ipv4分类编址方法)
		- [11.1.1. 【2017 36】](#1111-2017-36)
	- [11.2. Ipv4划分子网编址方法](#112-ipv4划分子网编址方法)
		- [11.2.1. 【2012 39】](#1121-2012-39)
	- [11.3. 无分类编址方法](#113-无分类编址方法)
		- [11.3.1. 【2011 38】](#1131-2011-38)
		- [11.3.2. 【2018 38】](#1132-2018-38)
		- [11.3.3. 【2021 35】](#1133-2021-35)
	- [11.4. IPv4地址的应用规划](#114-ipv4地址的应用规划)
		- [11.4.1. 【2019 37】](#1141-2019-37)
	- [11.5. 数据报传送过程中IPv4地址与MAC地址的变化情况](#115-数据报传送过程中ipv4地址与mac地址的变化情况)
	- [11.6. IP数据报的发送和转发过程](#116-ip数据报的发送和转发过程)
		- [11.6.1. 【2019 47】](#1161-2019-47)
	- [11.7. 片偏移](#117-片偏移)
		- [11.7.1. 【2020 36】](#1171-2020-36)
	- [11.8. RIP](#118-rip)
		- [11.8.1. 【2010 35】](#1181-2010-35)
		- [11.8.2. 【2021 37】](#1182-2021-37)
	- [11.9. OSPF](#119-ospf)
		- [11.9.1. 【2014 43改】](#1191-2014-43改)
	- [11.10. BGP](#1110-bgp)
		- [11.10.1. 【2013 46(3)】](#11101-2013-463)
		- [11.10.2. 【2017 37】](#11102-2017-37)
	- [11.11. ICMP](#1111-icmp)
		- [11.11.1. 【2010 36】](#11111-2010-36)
	- [11.12. SDN题目](#1112-sdn题目)

<!-- /TOC -->

## 1. 网络层概述

### 1.1. 分组转发和路由选择

- 网络层的主要任务就是**将分组从源主机经过多个网络和多段链路传输到目的主机**，可以将该任务划分为组转发和路由选择两种重要的功能。

<img src="chapter-4.assets/image-20221116200859197.png" alt="image-20221116200859197" style="zoom:50%;" />

### 1.2. 网络层向其上层提供的两种服务

<img src="chapter-4.assets/image-20221116201529158.png" alt="image-20221116201529158" style="zoom:40%;" />

#### 1.2.1. 面向连接的虚电路服务

- 核心思想是**“可靠通信应由网络自身来保证”**。
- 必须首先**建立网络层连接 —— 虚电路**（Virtual Circuit，VC），以保证通信双方所需的一切网络资源。
- 通信双方**沿着已建立的虚电路发送分组**。
- 通信结束后，需要**释放**之前所建立的虚电路。

<img src="chapter-4.assets/image-20221116201159453.png" alt="image-20221116201159453" style="zoom:48%;" />

-   这种通信方式如果再使用可靠传输的网络协议，就可使所发送的分组最终正确（无差错按序到达、不丢失、不重复）到达接收方。
-   很多广域分组交换网都使用面向连接的虚电路服务。例如，曾经的X.25和逐渐过时的帧中继（Frame Relay，FR）、异步传输模式（Asynchronnous Transfer Mode，ATM）。
-   然而，因特网的先驱者并没有采用这种设计思想，而是采用了无连接的数据报服务。

#### 1.2.2. 无连接的数据报服务

- 核心思想是**“可靠通信应由用户主机来保证”**。
- **不需要建立网络层连接。**
- **每个分组可走不同的路径**。 因此，每个分组的首部都必须携带目的主机的完整地址。
- 通信结束后，**没有需要释放的连接。**

<img src="chapter-4.assets/image-20221116201635144.png" alt="image-20221116201635144" style="zoom:46%;" />

-   这种通信方式所传送的分组可能误码、丢失、重复和失序。

## 2. 网际协议IP
- 网际协议（Internet Protocol，IP）是TCP/IP体系结构网际层中的核心协议。

<img src="chapter-4.assets/image-20221116201948342.png" alt="image-20221116201948342" style="zoom:50%;" />


### 2.1. 异构网络互连

<img src="chapter-4.assets/image-20221116202153700.png" alt="image-20221116202153700" style="zoom: 40%;" />

- 这些网络的拓扑、性能以及所使用的网络协议都不尽相同，这是由用户需求的多样性造成的，没有一种单一的网络能够适应所有用户的需求。
- 要将众多的异构型网络都互连起来，并且能够互相通信，则会面临许多需要解决的问题。
	- 不同的网络接入机制
	- 不同的差错恢复方法
	- 不同的路由选择技术
	- 不同的寻址方案
	- 不同的最大分组长度
	- 不同的服务（面向连接服务和无连接服务）

### 2.2. IPv4地址及其编址方法

<img src="chapter-4.assets/image-20221116220727056.png" alt="image-20221116220727056" style="zoom:40%;" />

#### 2.2.1. 概述
- IPv4地址是给因特网（Internet）上的**每一个主机（或路由器）的每一个接口**分配的一个在全世界范围内**唯一的32比特的标识符**。

<img src="chapter-4.assets/image-20221116202520425.png" alt="image-20221116202520425" style="zoom:40%;" />

- IPv4地址的编址方法经历了三个历史阶段

<img src="chapter-4.assets/image-20221116202556806.png" alt="image-20221116202556806" style="zoom:33%;" />

#### 2.2.2. 表示方法：点分十进制

-   举例

<img src="chapter-4.assets/image-20221116202706870.png" alt="image-20221116202706870" style="zoom:33%;" />

-   练习

<img src="chapter-4.assets/image-20221116202732127.png" alt="image-20221116202732127" style="zoom:33%;" />

-   二进制转十进制

<img src="chapter-4.assets/image-20221116203028122.png" alt="image-20221116203028122" style="zoom:40%;" />

-   十进制转二进制

<img src="chapter-4.assets/image-20221116203243849.png" alt="image-20221116203243849" style="zoom:45%;" />

#### 2.2.3. 分类编制方法

-   IPv4分类编址方法不够灵活、容易造成大量IPv4地址资源浪费。

<img src="chapter-4.assets/image-20221116203455146.png" alt="image-20221116203455146" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116203758601.png" alt="image-20221116203758601" style="zoom:48%;" />

<img src="chapter-4.assets/image-20221116203649141.png" alt="image-20221116203649141" style="zoom:44%;" />

-   A类细节

<img src="chapter-4.assets/image-20221116203936665.png" alt="image-20221116203936665" style="zoom:42%;" />

-   B类细节

<img src="chapter-4.assets/image-20221116204140404.png" alt="image-20221116204140404" style="zoom:48%;" />

-   C类细节

<img src="chapter-4.assets/image-20221116204343008.png" alt="image-20221116204343008" style="zoom:48%;" />


-   **一般不使用的Ipv4地址**

<img src="chapter-4.assets/image-20221116204530751.png" alt="image-20221116204530751" style="zoom:45%;" />

-   练习

<img src="chapter-4.assets/image-20221116204435549.png" alt="image-20221116204435549" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116205027239.png" alt="image-20221116205027239" style="zoom:45%;" />

#### 2.2.4. 划分子网的编址方法

-   在主机号中借用几位比特作为子网号。
-   子网掩码：表明表明分类IPv4地址的主机号部分被借用了几个比特作为子网号。
	-   由32比特构成。
	-   用左起多个**连续的比特1**对应IPv4地址中的**网络号和子网号**。
	-   之后的多个**连续的比特0**对应IPv4地址中的**主机号**。
- 将划分子网的IPv4地址与相应的子网掩码进行**逐比特的逻辑与运算**，就可得到该IPv4地址所在子网的网络地址。

<img src="chapter-4.assets/image-20221116205534553.png" alt="image-20221116205534553" style="zoom:40%;" />

-   默认子网掩码
    -   指在未划分子网的情况下使用的子网掩码
    -   ABC类主机号全置为0

<img src="chapter-4.assets/image-20221116214132279.png" alt="image-20221116214132279" style="zoom:45%;" />

-   子网划分细节——练习

<img src="chapter-4.assets/image-20221116210040279.png" alt="image-20221116210040279" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116210131662.png" alt="image-20221116210131662" style="zoom:41%;" />

#### 2.2.5. 无分类编址方法

- 无分类编址方法使用的地址掩码与划分子网使用的子网掩码类似，由32比特构成。
	- 用左起多个**连续的比特1**对应IPv4地址中的**网络前缀**。
	- 之后的多个**连续的比特0**对应IPv4地址中的**主机号**。
- 用斜线记法标记网络前缀比特数。
    - **/30** 应用在*分配只有两个路由器接口的点对点链路。*【2019 47(2)】


<img src="chapter-4.assets/image-20221116221317888.png" alt="image-20221116221317888" style="zoom:33%;" />

- 无分类域间路由选择（Classless Inter-Domain Routing，CIDR ）
	- CIDR消除了传统A类、B类和C类地址以及划分子网的概念。
	- CIDR可以更加有效地分配IPv4地址资源，并且可以在IPv6使用之前允许因特网的规模继续增长。

- CIDR地址块：由将网络前缀都相同的、连续的多个无分类IPv4地址组成
	- 地址块中的最小地址
	- 地址块中的最大地址
	- 地址块中的地址数
	- 地址块中聚合某类网络（A类、B类、C类）的数量
	- 地址掩码

-   CIDR细节练习

<img src="chapter-4.assets/image-20221116222000830.png" alt="image-20221116222000830" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116221948613.png" alt="image-20221116221948613" style="zoom:44%;" />

- 使用无分类编址方法，可以根据客户的需要分配适当大小的CIDR地址块，因此可以更加有效地分配IPv4的地址空间。

<img src="chapter-4.assets/image-20221116222112211.png" alt="image-20221116222112211" style="zoom:45%;" />


- 使用无分类编址方法的另一个好处是路由聚合（也称为构造超网）。
    - 网络前缀越长，地址块越小，路由越具体。
    - 若路由器查表转发分组时发现有多条路由条目匹配，则选择网络前缀最长的那条路由条目，这称为最长前缀匹配，因为这样的路由更具体。

<img src="chapter-4.assets/image-20221116222628768.png" alt="image-20221116222628768" style="zoom:40%;" />

### 2.3. IPv4地址的应用规划

<img src="chapter-4.assets/image-20221116225603391.png" alt="image-20221116225603391" style="zoom:50%;" />

#### 2.3.1. 定长子网掩码

<img src="chapter-4.assets/image-20221116225653016.png" alt="image-20221116225653016" style="zoom:50%;" />

#### 2.3.2. 变长子网掩码

<img src="chapter-4.assets/image-20221116231509455.png" alt="image-20221116231509455" style="zoom:50%;" />

- 在地址块中选取子块的原则
	- 每个子块的起点位置不能随便选取，只能选取主机号部分是块大小整数倍的地址作为起点。
	- **建议先为大的子块选取。**

### 2.4. IPv4地址与MAC地址

#### 2.4.1. IPv4地址与MAC地址的封装位置

<img src="chapter-4.assets/image-20221116233412850.png" alt="image-20221116233412850" style="zoom:45%;" />

#### 2.4.2. 数据包传送过程中IPv4地址与MAC地址的变化情况

<img src="chapter-4.assets/image-20221116233843719.png" alt="image-20221116233843719" style="zoom:50%;" />

#### 2.4.3. IPv4地址与MAC地址的关系

<img src="chapter-4.assets/image-20221116234045947.png" alt="image-20221116234045947" style="zoom:50%;" />

### 2.5. 地址解析协议ARP

- Address Resolution Protocol

<img src="chapter-4.assets/image-20221116234600134.png" alt="image-20221116234600134" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116234806435.png" alt="image-20221116234806435" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116234836442.png" alt="image-20221116234836442" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221116234851440.png" alt="image-20221116234851440" style="zoom:43%;" />

<img src="chapter-4.assets/image-20221116235009316.png" alt="image-20221116235009316" style="zoom:48%;" />

### 2.6. IP数据报的发送和转发流程

-   单播

    -   默认网关：路由器的IP地址

    -   将ip数据报中的目的地址与路由表中的地址掩码进行逻辑与运算找到下一跳

<img src="chapter-4.assets/image-20221117003200719.png" alt="image-20221117003200719" style="zoom:45%;" />

<img src="chapter-4.assets/image-20221117003213489.png" alt="image-20221117003213489" style="zoom:45%;" />

-   广播

<img src="chapter-4.assets/image-20221117003338112.png" alt="image-20221117003338112" style="zoom:44%;" />

#### 2.6.1. 主机发送IP数据报

- 判断目的主机是否与自己在同一个网络
	- 若在同一个网络，则属于**直接交付**
	- 若不在同一个网络，则属于**间接交付**。发送给主机所在网络的默认网关（路由器），由**默认网关帮忙转发**。

#### 2.6.2. 路由器转发IP数据报

- ① 检查收到的P数据报是否正确（生存时间是否结束；首部是否误码）
	- 若出错，则丢弃该P数据报并给发送该P数据报的源主机发送差错报告；
	- 若正确，则进行查表转发。
- ② 基于P数据报首部中的目的P地址在路由表中进行查找
	- 若找到匹配的路由条目，则按该路由条目的指示进行转发；
	- 若找不到匹配的路由条目，则丢弃该P数据报，并向发送该P数据报的源主机发送差错报告。
- ③ 查找步骤
  - 先根据路由表中目的地址的网络前缀，得出各目的地址的子网掩码。
  - 将子网掩码与所收到的IP数据包中的目的地址相与。
  - 若相与结果和**路由表中对应的目的地址**匹配，则选取网络前缀最长的那个目的地址进行转发。
  - 若相与结果不匹配任一目的地址，则选择默认路由0.0.0.0/0进行转发。

### 2.7. IPv4数据报的首部格式

- IPv4数据报的首部格式及其内容是实现IPv4协议各种功能的基础。
- 在TCP/IP标准中，各种数据格式常常以32比特（即4字节）为单位来描述。

<img src="chapter-4.assets/image-20221117010115631.png" alt="image-20221117010115631" style="zoom:45%;" />

- 固定部分是指每个IPv4数据报都必须要包含的部分。
- 某些IPv4数据报的首部，除了包含20字节的固定部分，还包含一些可选的字段来增加IPv4数据报的功能。
- IPv4数据报首部中的各字段或某些字段的组合，用来表达IPv4协议的相关功能。

#### 2.7.1. 版本

- **长度为4个比特**，用来表示IP协议的版本。
- 通信双方使用的IP协议的版本必须一致。目前广泛使用的IP协议的版本号为4（即IPv4）。


#### 2.7.2. 首部长度

- **长度为4个比特**，该字段的取值**以4字节为单位**，用来表示IPv4数据报的首部长度。
    - 最小取值为二进制的0101，即十进制的5，再乘以4字节单位，表示IPv4数据报首部只有20字节固定部分。
    - 最大取值为二进制的1111，即十进制的15，再乘以4字节单位，表示IPv4数据报首部包含20字节固定部分和最大40字节可变部分。

#### 2.7.3. 可选字段

- 长度从1字节到40字节不等，用来支持排错、测量以及安全措施等功能.
    - 虽然可选字段增加了IPv4数据报的功能，但这同时也使得IPv4数据报的首部长度成为可变的，这就增加了因特网中每一个路由器处理IPv4数据报的开销。
    - 实际上，可选字段很少被使用。

#### 2.7.4. 填充

- 用来确保IPv4数据报的首部长度是4字节的整数倍，使用全0进行填充。

#### 2.7.5. 区分服务

- 长度为8个比特，用来获得更好的服务。

#### 2.7.6. 总长度

- **长度为16个比特**，该字段的取值**以字节为单位**，用来表示IPv4数据报的长度（首部长度+数据载荷长度）。
- 最大取值为二进制的16个比特1，即十进制的65535（很少传输这么长的IPv4数据报）。

-   计算举例

<img src="chapter-4.assets/image-20221117010704111.png" alt="image-20221117010704111" style="zoom:45%;" />

#### 2.7.7. IP数据包分片

<img src="chapter-4.assets/image-20221117010828143.png" alt="image-20221117010828143" style="zoom: 50%;" />

##### 2.7.7.1. 标识

- **长度为16个比特**，属于**同一个IPv4数据报的各分片数据报应该具有相同的标识**。
- IP软件会维持一个计数器，每产生一个IPv4数据报，计数器值就加1，并将此值赋给标识字段。

##### 2.7.7.2. 标志

- 最低位（More Fragment，MF）
	- MF=1表示本分片后面还有分片
	- MF=0表示本分片后面没有分片
- 中间位（Don't Fragment，DF）
	- DF=1表示不允许分片
	- DF=0表示允许分片
- 最高位为保留位，必须设置为0

##### 2.7.7.3. 片偏移

- 长度为13个比特，该字段的取值以8字节为单位。
- 作用：指出分片IPv4数据报的数据载荷偏移其在原IPv4数据报的位置有多远。
- 计算
    - 分片**第一个字节的序号**/8
    - 片偏移必须是整数，并且以8字节为单位，**若算出来小数，则需要调整分片长度为8的倍数**。【2021 36】


`计算举例`

<img src="chapter-4.assets/image-20221117011634738.png" alt="image-20221117011634738" style="zoom:45%;" />

#### 2.7.8. 生存时间（Time To Live，TTL）

- **长度为8个比特**，最大取值为二进制的11111111，即十进制的255。

- 该字段的取值最初以秒为单位。
	- 因此，IPv4数据报的最大生存时间最初为255秒。
	- 路由器转发IPv4数据报时，将其首部中该字段的值减去该数据报在路由器上所耗费的时间，若结果不为0就转发，否则就丢弃。

- 生存时间字段后来**改为以“跳数”为单位**
	- 路由器*收到待转发的IPv4数据报时，将其首部中的该字段的值减1*，若结果不为0就转发，否则就丢弃。
	
- 作用：**防止被错误路由的IPv4数据报无限制地在因特网中兜圈**。

    <img src="chapter-4.assets/image-20221117012751818.png" alt="image-20221117012751818" style="zoom:45%;" />


#### 2.7.9. 协议

- **长度为8个比特**
- 作用：*指明IPv4数据报的数据载荷是何种协议数据单元PDU*。

<img src="chapter-4.assets/image-20221117012959715.png" alt="image-20221117012959715" style="zoom:50%;" />

#### 2.7.10. 首部检验和

- 长度为16个比特
- 作用：用于检测IPv4数据报在传输过程中其首部是否出现了差错。
- IPv4数据报每经过一个路由器，其首部中的某些字段的值（例如生存时间TTL、标志以及片偏移等）都可能发生变化，因此**路由器都要重新计算一下首部检验和。**

##### 2.7.10.1. 首部检验和的计算方法

<img src="chapter-4.assets/image-20221117013930201.png" alt="image-20221117013930201" style="zoom: 33%;" />

-   由于网际层并不向其高层提供可靠传输的服务，并且计算首部检验和是一项耗时的操作，因此在IPv6中，路由器不再计算首部检验和，从而更快转发IP数据报。

#### 2.7.11. 源IP地址

- 长度为32个比特
- 作用：用来填写发送IPv4数据报的源主机的IPv4地址。

#### 2.7.12. 目的IP地址

- 长度为32个比特
- 用来填写接收IPv4数据报的目的主机的IPv4地址。

## 3. 静态路由配置

### 3.1. 人工配置静态路由

<img src="chapter-4.assets/image-20221117115719729.png" alt="image-20221117115719729" style="zoom:50%;" />

### 3.2. 默认路由0.0.0.0/0

<img src="chapter-4.assets/image-20221117120024936.png" alt="image-20221117120024936" style="zoom:50%;" />

-   默认路由条目中的目的网络0.0.0.0/0，其中0.0.0.0表示任意网络，而网络前缀“/0”（相应的地址掩码为0.0.0.0）是最短的网络前缀。
-   路由器在查找转发表转发IP数据报时，遵循**“最长前缀匹配”**的原则，因此**默认路由条目的匹配优先级最低**。
-   默认路由可以减少路由表所占用的存储空间和搜索路由表所耗费的时间。

### 3.3. 特定主机路由/32

-   **特定主机路由条目的匹配优先级最高**。

<img src="chapter-4.assets/image-20221117122517894.png" alt="image-20221117122517894" style="zoom:50%;" />

-   特定主机路由条目中的目的网络192.168.2.1/32，其中192.168.2.1是特定主机的IP地址，而网络前缀“/32”（相应地址掩码为255.255.255.255）是最长的网络前缀。
-   图中，在查表转发去往192.168.2.1这台特定主机的IP数据报时，192.168.2.0/24和192.168.2.1/32两个路由条目都可以匹配，遵循“最长前缀匹配”的原则，**按照匹配优先级最高的特定主机路由条目进行转发**。

### 3.4. 需注意的问题

-   进行静态路由配置需要认真考虑和谨慎操作，否则可能出现以下问题：
	-   路由条目配置错误，甚至导致出现**路由环路**。
	-   聚合路由条目时可能**引入不存在的网络**。

## 4. 因特网的路由选择协议

### 4.1. 路由选择分类

#### 4.1.1. 静态路由选择

- 采用**人工配置**的方式给路由器添加网络路由、默认路由和特定主机路由等路由条目。
- 静态路由选择**简单、开销小**，但**不能及时适应网络状态（流量、拓扑等）的变化。**
- 静态路由选择一般只在**小规模网络**中采用。

#### 4.1.2. 动态路由选择

- 路由器通过路由选择协议**自动获取**路由信息。
- 动态路由选择**比较复杂、开销比较大**，但**能较好地适应网络状态的变化。**
- 动态路由选择适用于**大规模网络**。

### 4.2. 因特网采用分层次的路由选择协议

#### 4.2.1. 特点

<img src="chapter-4.assets/image-20221117133446868.png" alt="image-20221117133446868" style="zoom:50%;" />

#### 4.2.2. 举例

<img src="chapter-4.assets/image-20221117133959051.png" alt="image-20221117133959051" style="zoom:25%;" />

### 4.3. 路由信息协议RIP（封装在UDP）

#### 4.3.1. 基本概念

-   路由信息协议（Routing Information Protocol，RIP）是内部网关协议中最先得到广泛使用的协议之一，其相关标准文档为[RFC 1058]。
-   距离向量（Distance-Vector，D-V）：RIP要求自治系统AS内的每一个路由器，都要维护从它自己到AS内其他每一个网络的距离记录。这组距离称为距离向量。
-   跳数（Hop Count）：度量（Metric）来衡量到达目的网络的距离
	-   将路由器**到直连网络的距离定义为1**。
	-   将路由器**到非直连网络的距离定义为所经过的路由器数加1**。
	-   允许一条路径最多只能包含15个路由器，**距离等于16时相当于不可达**。因此RIP**只适用于小型互联网**。

<img src="chapter-4.assets/image-20221117134535097.png" alt="image-20221117134535097" style="zoom:40%;" />

-   好的路由：距离短，即**所通过路由器数量最少的路由**。
	-   如下图，RIP认为R1到R5的好路由是：R1→R4→R5

<img src="chapter-4.assets/image-20221117134752692.png" alt="image-20221117134752692" style="zoom: 50%;" />


-   等价负载均衡：当到达同一目的网络有多条RIP距离相等的路由时，可以进行等价负载均衡，也就是将通信量均衡地分布到多条等价的路径上。

<img src="chapter-4.assets/image-20221117134814393.png" alt="image-20221117134814393" style="zoom:50%;" />

-   特点
    -   和谁交换信息
	    -   仅和**相邻路由器**交换信息。
    -   交换什么信息
	    -   路由器自己的**路由表**。
	    -   即本路由器到所在自治系统AS中各网络的最短RIP距离，以及到各网络应经过的下一跳路由器。
    -   何时交换信息
	    -   **周期性交换**（例如，每个约30秒）。
	    -   为了加快RIP的收敛速度，当网络拓扑发生变化时，路由器要及时向相邻路由器通告拓扑变化后的路由信息，这称为**触发更新**。

#### 4.3.2. 基本工作过程

<img src="chapter-4.assets/image-20221117135350901.png" alt="image-20221117135350901" style="zoom:50%;" />

-   路由器刚开始工作时，只知道自己到直连网络的RIP距离为1。
-   每个路由器仅和相邻路由器周期性地交换并更新路由信息。
-   收敛：若干次交换和更新后，每个路由器都知道到达本自治系统AS内各网络的最短距离和下一跳路由器。

#### 4.3.3. 距离向量算法

<img src="chapter-4.assets/image-20221117140417858.png" alt="image-20221117140417858" style="zoom:50%;" />

-   D不需要关心C中下一跳的内容，收到后将C中的下一条均改为C。

-   从D修改后路由器C的路由表的目的网络往下看
    
    -   N2：到达目的网络，相同的下一跳，表示信息为最新，要更新D中N2的RIP距离
    -   N3：发现新的网络，向D的路由表中添加。
    -   N6：到达目的网络，不同的下一条（F、C），新路由RIP更短（有优势），要更新D中N6的RIP距离
    -   N8：到达目的网络，不同的下一条，RIP距离相等，可以等价负载均衡，向D的路由表中添加。
    -   N9：到达目的网络，不同的下一条（F、C），新路由RIP更长（处于劣势），不更新更新D中N9的RIP距离
    
-   更新后D的路由表如下

<img src="chapter-4.assets/image-20221117141502053.png" alt="image-20221117141502053" style="zoom:40%;" />

-   除了上述RIP路由条目更新规则，在RIP的距离向量算法中还包含以下一些**时间参数**：
    -   路由器每隔大约30秒向其所有相邻路由器发送路由更新报文。
    -   若180秒（默认）没有收到某条路由条目的更新报文，则把该路由条目标**记为无效（即把RIP距离设置为16，表示不可达）**。
    -   若再过一段时间（如120秒），还没有收到该路由条目的更新报文，则将该路由条目从路由表中删除。

#### 4.3.4. 存在的问题——“坏消息传播得慢”

<img src="chapter-4.assets/image-20221117145506502.png" alt="image-20221117145506502" style="zoom:45%;" />

#### 4.3.5. 版本和相关报文的封装

<img src="chapter-4.assets/image-20221117145623175.png" alt="image-20221117145623175" style="zoom:45%;" />

#### 4.3.6. 优缺点

<img src="chapter-4.assets/image-20221117145650769.png" alt="image-20221117145650769" style="zoom:45%;" />

### 4.4. 开放最短路径优先OSPF（封装在IP）

#### 4.4.1. 基本概念

- 开放最短路径优先（Open Shortest Path First，OSPF）协议是为了**克服路由信息协议RIP的缺点**在1989年开发出来的。
	- “开放”表明OSPF协议不是受某一厂商控制，而是公开发表的。
	- “最短路径优先”是因为**使用了Dijkstra提出的最短路径算法**（Shortest Path First，SPF）。

- “开放最短路径优先”只是一个路由选择协议的名称，但这**并不表示其他的路由选择协议不是“最短路径优先”**。实际上，用于自治系统AS内部的各种路由选择协议（例如RIP），都要寻找一条“最短”的路径。

- OSPF是**基于链路状态**的，而不像RIP是基于距离向量的。
	- 链路状态（Link State，LS）是指本路由器都和哪些路由器相邻，以及相应链路的“代价（cost）”。
		- 	“代价”用来表示费用、距离、时延和带宽等，这些都由网络管理人员来决定。

<img src="chapter-4.assets/image-20221117152710843.png" alt="image-20221117152710843" style="zoom:40%;" />

- 优点
    - OSPF**基于链路状态**并采用最短路径算法计算路由，从算法上保证了不会产生路由环路。
    - OSPF**不限制网络规模，更新效率高，收敛速度快**。

-   OSPF路由器邻居关系的建立和维护
	-   OSPF相邻路由器之间通过交互问候（Hello）分组来建立和维护邻居关系。

<img src="chapter-4.assets/image-20221117153134725.png" alt="image-20221117153134725" style="zoom:25%;" />

- 链路状态通告

<img src="chapter-4.assets/image-20221117153422319.png" alt="image-20221117153422319" style="zoom:40%;" />


- 链路状态更新分组

-   链路状态数据库 

<img src="chapter-4.assets/image-20221117154115442.png" alt="image-20221117154115442" style="zoom:25%;" />

-   基于链路状态数据库进行最短路径优先计算

<img src="chapter-4.assets/image-20221117154233588.png" alt="image-20221117154233588" style="zoom:42%;" />


#### 4.4.2. 五种分组类型

<img src="chapter-4.assets/image-20221117154307680.png" alt="image-20221117154307680" style="zoom:45%;" />

#### 4.4.3. 基本工作过程

<img src="chapter-4.assets/image-20221117161619148.png" alt="image-20221117161619148" style="zoom:40%;" />

#### 4.4.4. 多点接入网络中得OSPF路由器

<img src="chapter-4.assets/image-20221117162201438.png" alt="image-20221117162201438" style="zoom:45%;" />

#### 4.4.5. OSPF划分区域

- 为了使OSPF协议能够**用于规模很大的网络**，OSPF**把一个自治系统AS再划分为若干个更小的范围**，称为**区域（area）**。
	- 每个区域的规模不应太大，一般所包含的路由器不应超过200个。
	- 划分区域的好处就是把利用洪泛法交换链路状态信息的范围局限于每一个区域，而不是整个自治系统AS，这样就减少了整个网络上的通信量。

<img src="chapter-4.assets/image-20221117162643039.png" alt="image-20221117162643039" style="zoom:45%;" />

-   自治系统边界路由器（AS Border Router，ASBR）：R6
-   主干路由器（Backbone Router，BBR）：R3、R4、R5、R6和R7
-   区域内路由器（Internal Router，IR）：区域1内的R1和R2，区域2内的R8，区域3内的R9
-   区域边界路由器（Area Border Router，ABR）：R3、R4和R7

### 4.5. 边界网关协议BGP（封装在TCP）

#### 4.5.1. 基本概念

- 边界网关协议（Border Gateway Protocol，BGP）属于外部网关协议EGP这个类别，用于自治系统AS之间的路由选择协议。
	- 由于在不同AS内度量路由的“代价”（距离、带宽、费用等）可能不同，因此对于AS之间的路由选择，使用统一的“代价”作为度量来寻找最佳路由是不行的。
	- AS之间的路由选择还必须考虑相关策略（政治、经济、安全等）。
	- BGP只能是力求寻找一条能**够到达目的网络且比较好的路由**（即不能兜圈子），而**并非要寻找一条最佳路由。**

<img src="chapter-4.assets/image-20221117165757508.png" alt="image-20221117165757508" style="zoom:40%;" />

- BGP发言人
  - 在配置BGP时，每个AS的管理员要**选择至少一个路由器作为该AS的“BGP发言人”。**
  - 一般来说，两个BGP发言人都是通过一个共享网络连接在一起的，而**BGP发言人往往就是BGP边界路由器**。
  - 使用TCP连接交换路由信息的两个BGP发言人，彼此称为对方的**邻站（neighbor）或对等站（peer）。**
  - BGP发言人除了**运行BGP协议外，还必须运行自己所在AS所使用的内部网关协议IGP**，例如RIP或OSPF。
  - BGP发言人交换网络可达性的信息，也就是要到达某个网络所要经过的一系列自治系统。
  - 当BGP发言人相互交换了网络可达性的信息后，各BGP发言人就根据所采用的策略，从收到的路由信息中找出到达各自治系统的较好的路由，也就是**构造出树形结构且不存在环路的自治系统连通图。**
  - BGP适用于**多级结构的因特网。**

<img src="chapter-4.assets/image-20221117170324705.png" alt="image-20221117170324705" style="zoom:45%;" />

-   BGP交换路由信息，要先**建立TCP连接**，在此基础上交换TCP报文。

#### 4.5.2. BGP-4的四种报文

<img src="chapter-4.assets/image-20221117170521861.png" alt="image-20221117170521861" style="zoom:50%;" />

### 4.6. 路由器的基本工作原理

-   路由器是一种具有多个输入端口和输出端口的专用计算机，其任务是转发分组。

<img src="chapter-4.assets/image-20221117172224155.png" alt="image-20221117172224155" style="zoom:40%;" />


## 5. 网际控制协议ICMP（封装在IP）

### 5.1. 概述

- 为了**更有效地转发IP数据报以及提高IP数据报交付成功的机会**，TCP/IP体系结构的网际层使用了**网际控制报文协议（Internet Control Message Protocol，ICMP）**[RFC 792]。
- 主机或路由器使用ICMP来发送**差错报告报文和询问报文**。
- ICMP报文被**封装在IP数据报中发送**。

### 5.2. ICMP报文种类

<img src="chapter-4.assets/image-20221117205046466.png" alt="image-20221117205046466" style="zoom:40%;" />

#### 5.2.1. 差错报告报文

`用来向主机或路由器报告差错情况。`

-   终点不可达
-   源点抑制
-   时间超过（超时）
-   参数问题
-   改变路由（重定向）

```
以下情况不应发送ICMP差错报告报文：
    对ICMP差错报告报文不再发送ICMP差错报告报文。
    对第一个分片的IP数据报片的所有后续数据报片都不发送ICMP差错报告报文。
    对具有多播地址的IP数据报都不发送ICMP差错报告报文。
    对具有特殊地址（例如127.0.0.0或0.0.0.0）的IP数据报不发送ICMP差错报告报文。
```

#### 5.2.2. 询问报文

`用来向主机或路由器询问情况。`

-   回送请求和回答
	-   由主机或路由器向一个特定的目的主机或路由器发出。
	-   收到此报文的主机或路由器必须给发送该报文的源主机或路由器发送ICMP回送回答报文。
	-   这种询问报文**用来测试目的站是否可达以及了解其有关状态。**
-   时间戳请求和回答
	-   用来请求某个主机或路由器回答当前的日期和时间。
	-   在ICMP时间戳回答报文中有一个32比特的字段，其中写入的整数代表从1900年1月1日起到当前时刻一共有多少秒。
	-   这种询问报文**用来进行时钟同步和测量时间。**


### 5.3. ICMP的典型应用

#### 5.3.1. 分组网间探测（Packet InterNet Groper，PING）

- 分组网间探测PING**用来测试主机或路由器之间的连通性**。
	- PING是TCP/IP体系结构的应用层**直接使用网际层ICMP的一个例子**，它并**不使用运输层的TCP或UDP**。
	- PING应用所使用的ICMP**报文类型为回送请求和回答**。

```
C:\Users\ASUS>ping www.bilibili.com

正在 Ping a.w.bilicdn1.com [2409:8c3c:4:2::75] 具有 32 字节的数据:
来自 2409:8c3c:4:2::75 的回复: 时间=31ms
来自 2409:8c3c:4:2::75 的回复: 时间=26ms
来自 2409:8c3c:4:2::75 的回复: 时间=25ms
来自 2409:8c3c:4:2::75 的回复: 时间=29ms

2409:8c3c:4:2::75 的 Ping 统计信息:
    数据包: 已发送 = 4，已接收 = 4，丢失 = 0 (0% 丢失)，
往返行程的估计时间(以毫秒为单位):
    最短 = 25ms，最长 = 31ms，平均 = 27ms
```

- 某些主机或服务器为了防止恶意攻击，并会不理睬外界发来的ICMP回送请求报文。


#### 5.3.2. 跟踪路由（traceroute）

- 跟踪路由应用traceroute，用于**探测IP数据报从源主机到达目的主机要经过哪些路由器。**
    - 在UNIX版本中，具体命令为“**traceroute**”，其在运输层**使用UDP协议**，在网络层使用ICMP报文类型**只有差错报告报文**。
    - 在Windows版本中，具体命令为“tracert”，其应用层**直接使用网际层的ICMP协议**，所使用的ICMP报文类型**有回送请求和回答报文以及差错报告报文。**

```
C:\Users\ASUS>tracert -d www.bilibili.com

通过最多 30 个跃点跟踪
到 a.w.bilicdn1.com [240e:bf:b800:4300:1::15] 的路由:

  1     6 ms     *       33 ms  2001:da8:20c:a053::1
  2     2 ms     1 ms     1 ms  2001:da8:20c:f0e8::1
  3     3 ms     3 ms     3 ms  2001:250:215::1
  4     *        *        *     请求超时。
  5     4 ms     3 ms     6 ms  2001:da8:2:122::1
  6    15 ms     5 ms     7 ms  2001:da8:2:4::1
  7     4 ms     3 ms     4 ms  2001:da8:2:701:110:108:14:2
  8     4 ms     3 ms     5 ms  240e::c:1:6200:302
  9     *       23 ms    23 ms  240e::1:11:51:6303
 10    23 ms    25 ms    24 ms  240e:f:b800:14e::3
 11    36 ms    24 ms    24 ms  240e:f:b800:400::3
 12    26 ms    26 ms    26 ms  240e:f:b800:c85::3
 13     *        *        *     请求超时。
 14    21 ms    23 ms    23 ms  240e:bf:b800:4300:1::15

跟踪完成。
```

<img src="chapter-4.assets/image-20221117210836226.png" alt="image-20221117210836226" style="zoom:33%;" />

## 6. 虚拟专用网VPN和网络地址转换NAT

### 6.1. 虚拟专用网VPN

-   虚拟专用网（Virtual Private Network，VPN）**利用公用的因特网**作为本机构各专用网之间的通信载体，这样形成的网络又称为虚拟专用网。
-   给专用网内各主机配置的IP地址应该是**该专用网所在机构可以自行分配的IP地址**，这类IP地址仅在机构内部有效，称为专用地址（Private Address），不需要向因特网的管理机构申请。
-   [RFC 1918]规定了以下三个CIDR地址块中的地址作为专用地址：
	-   10.0.0.0~10.255.255.255（CIDR地址块10/8）
	-   172.16.0.0~172.31.255.255（CIDR地址块172.16/12）
	-   192.168.0.0~192.168.255.255（CIDR地址块192.168/16）
- 很显然，全世界可能有**很多不同机构的专用网具有相同的专用IP地址**，但这并不会引起麻烦，因为这些专用地址仅在机构内部使用。
- 在因特网中的所有路由器，对目的地址是专用地址的IP数据报一律不进行转发，这需要由因特网服务提供者ISP对其拥有的因特网路由器进行设置来实现。

<img src="chapter-4.assets/image-20221117211734160.png" alt="image-20221117211734160" style="zoom:45%;" />

- 本例所示的是同一机构内不同部门的内部网络所构成的VPN，又称为**内联网VPN。**

### 6.2. 网络地址转换NAT

-   网络地址转换（Network Address Translation，NAT）技术于1994年被提出，用来缓解IPv4地址空间即将耗尽的问题。
	-   NAT**能使大量使用内部专用地址的专用网络用户共享少量外部全球地址来访问因特网上的主机和资源**。
	-   这种方法需要在专用网络连接到因特网的路由器上安装NAT软件。
	-   装有NAT软件的路由器称为**NAT路由器**，它**至少要有一个有效的外部全球地址$IP_{G}$**。
	-   这样，所有使用内部专用地址的主机在和外部因特网通信时，都要**在NAT路由器上将其内部专用地址转换成$IP_{G}$**。

#### 6.2.1. 最基本的NET方法

<img src="chapter-4.assets/image-20221117214156371.png" alt="image-20221117214156371" style="zoom:45%;" />

#### 6.2.2. 网络地址与端口号转换方法（NAPT）

- 由于目前绝大多数基于TCP/IP协议栈的网络应用，都使用运输层的传输控制协议TCP或用户数据报协议UDP，为了**更加有效地利用NAT路由器中的全球IP地址**，现在常**将NAT转换和运输层端口号结合使用**。
	- 这样就可以使内部专用网中使用专用地址的**大量主机，共用NAT路由器上的1个全球IP地址**，因而可以同时与因特网中的不同主机进行通信。

- 将NAT和运输层端口号结合使用，称为**网络地址与端口号转换**（Network Address and Port Translation，NAPT）
	- 现在很多家用路由器将家中各种智能设备（手机、平板、笔记本电脑、台式电脑、物联网设备等）接入因特网，这种路由器实际上就是一个**NAPT路由器**，但往往并不运行路由选择协议。

-   主机向因特网发送
    -   与主机A选择的源端口号相同，这纯属巧合（端口号仅在本主机中才有意义）。特意这样举例，就是为了能**更好地说明NAPT路由器还会对源端口号重新动态分配。**

<img src="chapter-4.assets/image-20221117214841062.png" alt="image-20221117214841062" style="zoom:45%;" />

-   因特网向主机发回

<img src="chapter-4.assets/image-20221117214945257.png" alt="image-20221117214945257" style="zoom:45%;" />

- 尽管NAT（和NAPT）的出现在很大程度上缓解了IPv4地址资源紧张的局面，**但NAT（和NAPT）对网络应用并不完全透明**，会对某些网络应用产生影响。
- NAT（和NAPT）的一个重要特点就是**通信必须由专用网内部发起**，因此**拥有内部专用地址的主机不能直接充当因特网中的服务器。**

<img src="chapter-4.assets/image-20221117215214561.png" alt="image-20221117215214561" style="zoom:40%;" />

- 对于目前P2P这类需要外网主机主动与内网主机进行通信的网络应用，在通过NAT时会遇到问题，需要网络应用自身使用一些特殊的**NAT穿透技术**来解决。

## 7. IP多播技术

### 7.1. 相关基本概念

-   多播（Multicast，也称为组播）是一种实现“一对多”通信的技术，与传统单播“一对一”通信相比，多播可以极大地节省网络资源。
	-   在因特网上进行的多播，称为IP多播。

<img src="chapter-4.assets/image-20221117215535961.png" alt="image-20221117215535961" style="zoom:45%;" />

- 实现IP多播，则因特网中的路由器需要解决的问题
	- IP多播数据报的寻址问题
	- 多播路由选择问题

### 7.2. IP多播地址和多播组

-   在IPv4中，**D类地址被作为多播地址**。

<img src="chapter-4.assets/image-20221117220239084.png" alt="image-20221117220239084" style="zoom:40%;" />

-   **多播地址只能用作目的地址**，而不能用作源地址。
-   用每一个D类地址来标识一个多播组，**使用同一个IP多播地址接收IP多播数据报的所有主机就构成了一个多播组。**
    -   **每个多播组的成员是可以随时变动的**，一台主机可以随时加入或离开多播组。
    -   **多播组成员的数量和所在的地理位置也不受限制，一台主机可以属于几个多播组。**
    -   非多播组成员也可以向多播组发送IP多播数据报

-   与IP数据报相同，IP多播数据报也是**“尽最大努力交付”**，不保证一定能够交付给多播组内的所有成员。
-   IPv4多播地址又可分为**预留的多播地址**（永久多播地址）、全球范围可用的多播地址以及**本地管理的多播地址**[RFC 3330]。

<img src="chapter-4.assets/image-20221117220302396.png" alt="image-20221117220302396" style="zoom:50%;" />

-   IP多播可以分为以下两种
  - 只在本局域网上进行的硬件多播。
  - 在因特网上进行的多播。

-   目前大部分主机都是通过局域网接入因特网的。因此，在因特网上进行多播的最后阶段，还是要把IP多播数据报在局域网上用硬件多播交付给多播组的所有成员。

### 7.3. 在局域网上进行硬件多播

-   由于MAC地址（也称为硬件地址）有多播MAC地址这种类型，因此只要**把IPv4多播地址映射成多播MAC地址**，即可**将IP多播数据报封装在局域网的MAC帧中**，而MAC帧首部中的目的MAC地址字段的值，就设置为由IPv4多播地址映射成的多播MAC地址。这样，可以很方便地**利用硬件多播来实现局域网内的IP多播。**
-   当给某个多播组的成员主机配置其所属多播组的IP多播地址时，系统就会根据映射规则从该IP多播地址生成相应的局域网多播MAC地址。

<img src="chapter-4.assets/image-20221118000558722.png" alt="image-20221118000558722" style="zoom:50%;" />

-   因特网号码指派管理局IANA，将自己从IEEE注册管理机构申请到的以太网MAC地址块中从01-00-5E-00-00- 00到01-00-5E-7F-FF-FF的多播MAC地址，用于映射IPv4多播地址。
    -   这些多播MAC地址的左起前25个比特都是相同的，剩余23个比特可以任意变化，因此共有$2^{23}$。

<img src="chapter-4.assets/image-20221118000651989.png" alt="image-20221118000651989" style="zoom:45%;" />

- IP多播地址与多播MAC地址的映射关系并不是唯一的

    - <img src="chapter-4.assets/image-20221118000756975.png" alt="image-20221118000756975" style="zoom:45%;" />

        

    - <img src="chapter-4.assets/image-20221118001055242.png" alt="image-20221118001055242" style="zoom:45%;" />


-   收到IP多播数据报的主机还要在网际层利用软件进行过滤，把不是主机要接收的IP多播数据报丢弃
	-   <img src="chapter-4.assets/image-20221118001236982.png" alt="image-20221118001236982" style="zoom:45%;" />

### 7.4. 在因特网上进行IP多播需要的两种协议

<img src="chapter-4.assets/image-20221118001918191.png" alt="image-20221118001918191" style="zoom:30%;" />

<img src="chapter-4.assets/image-20221118002200089.png" alt="image-20221118002200089" style="zoom:30%;" />

### 7.5. 网际组管理协议IGMP（封装在IP）

-   网际组管理协议IGMP目前的最新版本是2002年10月公布的IGMPv3[RFC 3376]。
-   IGMP报文被封装在IP数据报中传送

<img src="chapter-4.assets/image-20221118002526277.png" alt="image-20221118002526277" style="zoom:45%;" />

#### 7.5.1. 三种报文类型

- 成员报文报文
- 成员查询报文
- 离开组报文

#### 7.5.2. 基本工作原理

<img src="chapter-4.assets/image-20221118010105642.png" alt="image-20221118010105642" style="zoom:33%;" />

##### 7.5.2.1. 加入多播组

<img src="chapter-4.assets/image-20221118003049347.png" alt="image-20221118003049347" style="zoom:45%;" />

##### 7.5.2.2. 监视多播组的成员变化

-   多播路由器默认每隔125秒就向其直连网络发送一个封装有IGMP成员查询报文的IP多播数据报。
-   成员查询报文中，224.0.0.1为特殊的IP多播地址，在本网络中所有参加多播的主机和路由器的网际层都会接受该多播数据报。

<img src="chapter-4.assets/image-20221118004120413.png" alt="image-20221118004120413" style="zoom:45%;" />

-   收到IGMP成员查询报文的被查询多播组的任何成员，都会发送IGMP成员报告文作为应答。
-   为了减少不必要的重复应答，每个多播组只需要一个成员应答就行了。
-   应答采用**延迟响应**的策略，主机收到查询报文后再1-10秒内等待一段随机时间后进行响应（不是立即响应）。
-   在这段时间内如果收到了同组成员发送的成员报文报文，则取消响应。
    -   本例中B先发送成员报告报文，则A收到B的成员报告文后取消相应。

-   路由器R1收到B的成员报告报文后对其进行解析并更新多播组列表。

<img src="chapter-4.assets/image-20221118005243069.png" alt="image-20221118005243069" style="zoom:45%;" />


- 同一网络中的多播路由器可能不止一个，但**没有必要每个多播路由器都周期性地发送IGMP成员查询报文**。
- 只要在这些多播路由器中选择一个作为**查询路由器**，由查询路由器发送IGMP成员查询报文，而其他的多播路由器仅被动接收响应并更新自己的多播组列表即可。
- 选择查询路由器的方法：
	- 每个多播路由器若监听到源IP地址比自己的IP地址小的IGMP成员查询报文则退出选举。
	- 最后，网络中只有**IP地址最小的多播路由器成为查询路由器**。
##### 7.5.2.3. 退出多播组

- IGMPv2在IGMPv1的基础上增加了一个可选项：当主机要退出某个多播组时，可主动发送一个离开组报文而不必等待多播路由器的查询。这样可使多播路由器能够更快地发现某个组有成员离开。

<img src="chapter-4.assets/image-20221118005945755.png" alt="image-20221118005945755" style="zoom:45%;" />


### 7.6. 多播路由选择协议（封装在）

#### 7.6.1. 多播路由选择协议

-   多播路由选择协议的主要任务是：在多播路由器之间为每个多播组建立一个多播转发树。
	-   多播转发树连接多播源和所拥有该多播组成员的路由器。

- 建多播转发树的方法
	- 基于源树（Source-Base Tree）多播路由选择
	
	- 组共享树（Group-Shared Tree）多播路由选择
	
##### 7.6.1.1. 基于源树多播路由选择

-   反向路径多播算法（Reverse Path Multicasting，RPM）
    -   利用反向路径广播（Reverse Path Broadcasting，RPB）算法建立一个广播转发树。
        -   每一台路由器在收到一个广播分组时，**先检查该广播分组是否是从源点经最短路径传送来的。**
	        -   若是，本路由器就从自己除刚才接收该广播分组的接口的所有其他接口转发该广播分组。
	        -   否则，丢弃该广播分组。
	        -   如果本路由器有好几个邻居路由器都处在到源点的最短路径上，也就是存在好几条同样长度的最短路径，那么只能选取一条最短路径。**选取的规则是这几条最短路径中的邻居路由器的IP地址最小的那条最短路径。**
        -   RPB中“反向路径”的意思是：在计算最短路径时把源点当作终点。
        -   <img src="chapter-4.assets/image-20221118011736662.png" alt="image-20221118011736662" style="zoom: 50%;" />
    -   利用剪枝（Pruning）算法，剪除广播转发树中的下游非成员路由器，获得一个多播转发树。
        -   <img src="chapter-4.assets/image-20221118012203045.png" alt="image-20221118012203045" style="zoom:33%;" />
        -   若被剪枝的路由器通过IGMP又发现了新的多播组成员，则会向上游路由器发送一个嫁接报文，并重新加入到多播转发树中。
        -   尽管R2没有多播组成员，但也要保留R2以确保多播转发树的连通性。
    
- 要建立广播转发树，可以使用洪泛（Flooding）法。
	- 利用反向路径广播RPB算法生成的广播转发树，不会存在环路，因此可以避免广播分组在环路中兜圈。

	<img src="chapter-4.assets/image-20221118010737966.png" alt="image-20221118010737966" style="zoom:40%;" />

##### 7.6.1.2. 组共享树多播路由选择

- 组共享树多播路由选择采用**基于核心的分布式生成树算法**来建立共享树。
	- 该方法在**每个多播组中指定一个核心（core）路由器**，以该路由器为根，建立一棵连接多播组的所有成员路由器的生成树，作为多播转发树。
- 每个多播组中除了核心路由器，其他所有**成员路由器**都会向自己多播组中的核心路由器单播加入报文。
	- 加入报文通过单播朝着核心路由器转发，直到它**到达已经属于该多播生成树的某个节点或者直接到达该核心路由器**。
	- 加入报文所经过的路径，就确定了一条**从单播该报文的边缘节点到核心路由器之间的分支**，而这个**新分支就被嫁接到现有的多播转发树上**。

<img src="chapter-4.assets/image-20221118013100314.png" alt="image-20221118013100314" style="zoom:45%;" />

#### 7.6.2. 因特网的多播路由选择协议

<img src="chapter-4.assets/image-20221118013131797.png" alt="image-20221118013131797" style="zoom:50%;" />

## 8. 移动IP技术概述

### 8.1. 移动性对因特网应用的影响

<img src="chapter-4.assets/image-20221118013245877.png" alt="image-20221118013245877" style="zoom:45%;" />

### 8.2. 移动IP技术的相关基本概念

-   **移动IP（Mobile IP）**是因特网工程任务组IETF开发的一种技术[RFC 3344]，该技术使得**移动主机在各网络之间漫游时，仍然能够保持其原来的IP地址不变**。
-   移动IP技术还为因特网中的非移动主机提供了相应机制，使得它们能够将IP数据报正确发送到移动主机。

- 基本概念
	- 归属网络（Home Network）
		- 每个移动主机都有一个**默认连接的网络或初始申请接入的网络**。
	- 永久地址（Permanent Address）或归属地址（Home Address）。
		- 移动主机在**归属网络中的IP地址（在其整个移动通信过程中是始终不变的**）
	- 归属代理（Home Agent）
		- 在归属网络中，**代表移动主机执行移动管理功能的实体**。
		- 归属代理通常就是连接在归属网络上的路由器，然而它作为代理的特定功能则是在**网络层**完成的。
	- 外地网络（Foreign Network）或被访网络（VisitedNetwork）
		- 移动主机**当前漫游所在的网络**。
	- 外地代理（ForeignAgent）
		- 在外地网络中，**帮助移动主机执行移动管理功能的实体**。
		- 外地代理通常就是连接在外地网络上的路由器。
	- 转交地址（Care-of Address）
		- 外地代理会**为移动主机提供一个临时使用的属于外地网络**的转交地址。

### 8.3. 移动IP技术的基本工作原理

#### 8.3.1. 代理发现与注册

<img src="chapter-4.assets/image-20221118022447152.png" alt="image-20221118022447152" style="zoom:30%;" />

#### 8.3.2. 固定主机向移动主机发送IP数据报

<img src="chapter-4.assets/image-20221118022741365.png" alt="image-20221118022741365" style="zoom:50%;" />

<img src="chapter-4.assets/image-20221118023853953.png" alt="image-20221118023853953" style="zoom: 28%;" />


#### 8.3.3. 移动主机向固定主机发送IP数据报

<img src="chapter-4.assets/image-20221118024328296.png" alt="image-20221118024328296" style="zoom:25%;" />


#### 8.3.4. 同址转交地址方式

<img src="chapter-4.assets/image-20221118024448448.png" alt="image-20221118024448448" style="zoom:25%;" />


#### 8.3.5. 三角形路由问题

<img src="chapter-4.assets/image-20221118024719069.png" alt="image-20221118024719069" style="zoom:25%;" />

-   解决三角形路由问题的一种方法
    -   给固定主机配置一个**通信代理**，固定主机发送给移动主机的IP数据报，都要通过该**通信代理转发**。
    -   通信代理先从归属代理获取移动主机的转交地址，之后所有发送给移动主机的IP数据报，都利用转交地址直接通过IP隧道发送给移动主机的外地代理，而无须再通过移动主机的归属代理进行转发。
    -   这种方法以增加复杂性为代价，并要求固定主机也要配置通信代理，也就是对固定主机不再透明。

## 9. IPv6

### 9.1. IPv6的诞生背景

- IPv4地址存在缺陷
    - IPv4地址的长度仅为32比特
    - 早期的编址方法不够合理，造成IPv4地址资源的浪费。

- 2011年2月3日，因特网号码分配管理局IANA宣布IPv4地址已经分配完毕
- 如果没有网络地址转换NAT技术的广泛应用，IPv4早已停止发展。
- 解决IPv4地址耗尽的根本措施就是采用具有更大地址空间（IP地址的长度为128比特）的新版本IP，即IPv6。
- 到目前为止，IPv6还只是草案标准阶段

- 尽早开始过渡到IPv6的好处
	- 有更多时间来平滑过渡
	- 有更多时间来培养IPv6的专门人才
	- 及早提供IPv6服务比较便宜

### 9.2. IPv6引进的主要变化

<img src="chapter-4.assets/image-20221113115313786.png" alt="image-20221113115313786" style="zoom:33%;" />

### 9.3. IPv6数据包的基本首部

<img src="chapter-4.assets/image-20221113115233928.png" alt="image-20221113115233928" style="zoom: 30%;" />

### 9.4. IPv6数据包的扩展首部

<img src="chapter-4.assets/image-20221113115857414.png" alt="image-20221113115857414" style="zoom: 50%;" />

### 9.5. IPv6地址

#### 9.5.1. IPv6地址空间大小

<img src="chapter-4.assets/image-20221113120034870.png" alt="image-20221113120034870" style="zoom:50%;" />

#### 9.5.2. IPv6地址的表示方法

<img src="chapter-4.assets/image-20221113132938404.png" alt="image-20221113132938404" style="zoom:33%;" />

<img src="chapter-4.assets/image-20221113133637060.png" alt="image-20221113133637060" style="zoom:33%;" />

<img src="chapter-4.assets/image-20221113133657175.png" alt="image-20221113133657175" style="zoom:33%;" />

<img src="chapter-4.assets/image-20221113133713447.png" alt="image-20221113133713447" style="zoom:43%;" />

#### 9.5.3. IPv6地址的分类

<img src="chapter-4.assets/image-20221113133959853.png" alt="image-20221113133959853" style="zoom:33%;" />

<img src="chapter-4.assets/image-20221113134227184.png" alt="image-20221113134227184" style="zoom:41%;" />

### 9.6. 从IPv4向IPv6过渡

- 因特网上使用IPv4的路由器的数量太大，要让所有路由器都改用IPv6并不能一蹴而就。因此，从IPv4转变到IPv6只能采用**逐步演进**的办法。
- 另外，**新部署的IPv6系统必须能够向后兼容**，也就是IPv6系统必须能够接收和转发IPv4数据报，并且能够为IPv4数据报选择路由。

#### 9.6.1. 使用双协议栈
- 双协议栈（Dual Stack）是指在完全过渡到IPv6之前，使一部分主机或路由器装有IPv4和IPv6两套协议栈。
- 双协议栈主机或路由器既可以和IPv6系统通信，又可以和IPv4系统通信。
- 双协议栈主机或路由器记为IPv6/IPv4，表明它具有一个IPv6地址和一个IPv4地址。
	- 双协议栈主机在与IPv6主机通信时采用IPv6地址，而与IPv4主机通信时采用IPv4地址
	- 双协议栈主机通过域名系统DNS查询目的主机采用的IP地址：
		- 若DNS返回的是IPv4地址，则双协议栈的源主机就使用IPv4地址
		- 若DNS返回的是IPv6地址，则双协议栈的源主机就使用IPv6地址

<img src="chapter-4.assets/image-20221113140501907.png" alt="image-20221113140501907" style="zoom:33%;" />

#### 9.6.2. 使用隧道技术

- 隧道技术（Tunneling）的核心思想是：
	- 当IPv6数据报要进入IPv4网络时，将IPv6数据报重新封装成IPv4数据报，即整个IPv6数据报成为IPv4数据报的数据载荷。
	- 封装有IPv6数据报的IPv4数据报在IPv4网络中传输。
	- 当IPv4数据报要离开IPv4网络时，再将其数据载荷（即原来的IPv6数据报）取出并转发到IPv6网络。

<img src="chapter-4.assets/image-20221113140813293.png" alt="image-20221113140813293" style="zoom:33%;" />

### 9.7. 网际控制报文协议ICMPv6

#### 9.7.1. 概述

<img src="chapter-4.assets/image-20221113141017941.png" alt="image-20221113141017941" style="zoom:33%;" />

#### 9.7.2. ICMPv6报文的封装

<img src="chapter-4.assets/image-20221113141253442.png" alt="image-20221113141253442" style="zoom:25%;" />

#### 9.7.3. ICMPv6报文的分类

<img src="chapter-4.assets/image-20221113141259414.png" alt="image-20221113141259414" style="zoom:25%;" />

## 10. 软件定义网络SDN

### 10.1. 概述

<img src="chapter-4.assets/image-20221113153015457.png" alt="image-20221113153015457" style="zoom: 50%;" />

### 10.2. 网络层的数据层面和控制层面

<img src="chapter-4.assets/image-20221113153342923.png" alt="image-20221113153342923" style="zoom:41%;" />

### 10.3. OpenFlow协议

#### 10.3.1. 概述

<img src="chapter-4.assets/image-20221113153540950.png" alt="image-20221113153540950" style="zoom:50%;" />

<img src="chapter-4.assets/image-20221113153621464.png" alt="image-20221113153621464" style="zoom:45%;" />

#### 10.3.2. 传统意义上的数据层面的任务

<img src="chapter-4.assets/image-20221113153755626.png" alt="image-20221113153755626" style="zoom:40%;" />

#### 10.3.3. SDN中的广义转发

<img src="chapter-4.assets/image-20221113153820417.png" alt="image-20221113153820417" style="zoom:25%;" />

#### 10.3.4. OpenFLow交换机和流表

<img src="chapter-4.assets/image-20221113153925991.png" alt="image-20221113153925991" style="zoom:33%;" />

<img src="chapter-4.assets/image-20221113154436668.png" alt="image-20221113154436668" style="zoom:55%;" />

-   简单转发

<img src="chapter-4.assets/image-20221113154544128.png" alt="image-20221113154544128" style="zoom:45%;" />

-   负载均衡

<img src="chapter-4.assets/image-20221113154608415.png" alt="image-20221113154608415" style="zoom:50%;" />

-   防火墙

<img src="chapter-4.assets/image-20221113154653434.png" alt="image-20221113154653434" style="zoom:49%;" />

### 10.4. SDN体系结构

#### 10.4.1. SDN体系结构及其四个关键特征

-   基于流的转发
-   数据层面与控制层面分离
-   位于数据层面分组交换机之外的网络控制功能
-   可编程的网络

#### 10.4.2. SDN控制器

<img src="chapter-4.assets/image-20221113155239475.png" alt="image-20221113155239475" style="zoom:30%;" />

### 10.5. 总结

<img src="chapter-4.assets/image-20221113155508746.png" alt="image-20221113155508746" style="zoom: 27%;" />

## 11. 题目

### 11.1. IPv4分类编址方法

#### 11.1.1. 【2017 36】

<img src="chapter-4.assets/image-20221116204653403.png" alt="image-20221116204653403" style="zoom:45%;" />

### 11.2. Ipv4划分子网编址方法

#### 11.2.1. 【2012 39】

<img src="chapter-4.assets/image-20221116213523610.png" alt="image-20221116213523610" style="zoom:45%;" />

### 11.3. 无分类编址方法

#### 11.3.1. 【2011 38】

<img src="chapter-4.assets/image-20221116223116026.png" alt="image-20221116223116026" style="zoom:45%;" />

#### 11.3.2. 【2018 38】

<img src="chapter-4.assets/image-20221116223147567.png" alt="image-20221116223147567" style="zoom:45%;" />

#### 11.3.3. 【2021 35】

<img src="chapter-4.assets/image-20221116224950218.png" alt="image-20221116224950218" style="zoom:45%;" />

### 11.4. IPv4地址的应用规划

#### 11.4.1. 【2019 37】

<img src="chapter-4.assets/image-20221116231809685.png" alt="image-20221116231809685" style="zoom:45%;" />

### 11.5. 数据报传送过程中IPv4地址与MAC地址的变化情况

<img src="chapter-4.assets/image-20221116233925346.png" alt="image-20221116233925346" style="zoom:45%;" />

### 11.6. IP数据报的发送和转发过程

#### 11.6.1. 【2019 47】

<img src="chapter-4.assets/image-20221117005238928.png" alt="image-20221117005238928" style="zoom:50%;" />

### 11.7. 片偏移

#### 11.7.1. 【2020 36】

<img src="chapter-4.assets/image-20221117012208573.png" alt="image-20221117012208573" style="zoom:50%;" />

### 11.8. RIP

#### 11.8.1. 【2010 35】

<img src="chapter-4.assets/image-20221117142219355.png" alt="image-20221117142219355" style="zoom:50%;" />

#### 11.8.2. 【2021 37】

<img src="chapter-4.assets/image-20221117142529492.png" alt="image-20221117142529492" style="zoom:46%;" />

### 11.9. OSPF

#### 11.9.1. 【2014 43改】

<img src="chapter-4.assets/image-20221117163525284.png" alt="image-20221117163525284" style="zoom:45%;" />

### 11.10. BGP

#### 11.10.1. 【2013 46(3)】

<img src="chapter-4.assets/image-20221117170855425.png" alt="image-20221117170855425" style="zoom:45%;" />

#### 11.10.2. 【2017 37】

<img src="chapter-4.assets/image-20221117171001347.png" alt="image-20221117171001347" style="zoom:45%;" />

### 11.11. ICMP

#### 11.11.1. 【2010 36】

<img src="chapter-4.assets/image-20221117205340430.png" alt="image-20221117205340430" style="zoom:45%;" />

### 11.12. SDN题目

<img src="chapter-4.assets/image-20221113155414924.png" alt="image-20221113155414924" style="zoom:20%;" />
